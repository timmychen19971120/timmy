<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    /* æ–°å¢åœ–è¡¨å°ˆç”¨ç»ç’ƒå¡ç‰‡ */
    .chart-container {
        width: 100%;
        height: 250px;
        margin-top: 15px;
    }
    .stats-summary {
        display: flex;
        justify-content: space-around;
        margin-bottom: 20px;
        text-align: center;
    }
    .stat-item h3 { margin: 0; color: var(--neon); font-size: 1.5rem; }
    .stat-item p { margin: 5px 0; color: #636e72; font-size: 0.8rem; }
</style>

<div id="home-page" class="page active">
    <h1>TIMMY OS</h1>
    <div class="menu-grid">
        <div class="menu-item" onclick="showPage('tasks')"><i>âœ…</i><span>ä»»å‹™æ¸…å–®</span></div>
        <div class="menu-item" onclick="showPage('visual')"><i>ğŸ“Š</i><span>æ•¸æ“šçœ‹æ¿</span></div>
        </div>
</div>

<div id="visual-page" class="page">
    <div class="back-link" onclick="showPage('home')">â† è¿”å›ä¸­æ§å®¤</div>
    <div class="glass-card">
        <h2>ğŸ“ˆ é«”é‡è¶¨å‹¢ (è¿‘7æ¬¡)</h2>
        <div class="chart-container">
            <canvas id="weightChart"></canvas>
        </div>
    </div>
    <div class="glass-card">
        <h2>ğŸ¥› ä»Šæ—¥å–æ°´é€²åº¦</h2>
        <div class="stats-summary">
            <div class="stat-item">
                <h3 id="today-water">0</h3>
                <p>ä»Šæ—¥å·²å– (cc)</p>
            </div>
            <div class="stat-item">
                <h3 id="water-percent">0%</h3>
                <p>é”æˆç‡</p>
            </div>
        </div>
    </div>
</div>

<script>
    // åœ¨ script å€å¡Šæ–°å¢è¼‰å…¥æ•¸æ“šçš„é‚è¼¯
    function loadData() {
        fetch(API) // é€™è£¡æœƒè§¸ç™¼ GAS çš„ doGet
        .then(res => res.json())
        .then(data => {
            renderWeightChart(data.Weight);
            renderWaterStats(data.Water);
        });
    }

    function renderWeightChart(raw) {
        if(!raw || raw.length < 2) return;
        const last7 = raw.slice(-7); // æŠ“æœ€å¾Œ 7 ç­†
        const labels = last7.map(r => r[0]); // æ—¥æœŸ
        const values = last7.map(r => r[1]); // é«”é‡

        new Chart(document.getElementById('weightChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'é«”é‡ (kg)',
                    data: values,
                    borderColor: '#6c5ce7',
                    backgroundColor: 'rgba(108, 92, 231, 0.1)',
                    fill: true,
                    tension: 0.4 // è®“ç·šæ¢è®Šåœ“æ»‘
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } }
            }
        });
    }

    // æ¯æ¬¡æ‰“é–‹çœ‹æ¿åˆ†é æ™‚è‡ªå‹•é‡æ–°è¼‰å…¥æ•¸æ“š
    function showPage(p) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById(p + '-page').classList.add('active');
        if(p === 'visual') loadData();
    }
</script>
